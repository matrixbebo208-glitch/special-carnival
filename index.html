<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATRIX PRO | CLOUD SYSTEM</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root { --p-color: #0f172a; --m-green: #10b981; --accent: #6366f1; --white: #ffffff; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--bg); overflow: hidden; user-select: none; }
        
        .page { display: none; height: 100vh; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø¯ÙØ¹ */
        .auth-card { max-width: 420px; margin: 40px auto; background: white; padding: 35px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); text-align: center; }
        input, select { width: 100%; padding: 14px; margin: 12px 0; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 15px; outline: none; }
        .btn-main { background: var(--p-color); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-main:hover { background: #1e293b; transform: translateY(-2px); }

        /* Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ - ÙƒØ§Ø±Øª Ø§Ù„ÙÙŠØ²Ø§ */
        .visa-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 25px; border-radius: 20px; text-align: left; margin: 20px 0; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .visa-card .number { font-size: 20px; letter-spacing: 3px; margin-bottom: 15px; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†Ø¸Ø§Ù… */
        .layout { display: flex; height: 100vh; }
        .sidebar { width: 260px; background: var(--p-color); color: white; display: flex; flex-direction: column; padding: 20px; }
        .nav-item { padding: 15px; border-radius: 12px; cursor: pointer; margin-bottom: 8px; transition: 0.2s; color: #94a3b8; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); color: white; }
        .main-view { flex: 1; padding: 30px; overflow-y: auto; }

        .stat-box { background: white; padding: 25px; border-radius: 20px; border-bottom: 4px solid var(--accent); box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 20px; overflow: hidden; }
        th, td { padding: 15px; text-align: center; border-bottom: 1px solid #f1f5f9; }

        .wa-float { position: fixed; bottom: 30px; left: 30px; width: 65px; height: 65px; background: #25d366; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; text-decoration: none; font-size: 30px; font-weight: bold; box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4); z-index: 9999; }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="auth-page" class="page active">
        <div class="auth-card">
            <h1 style="color:var(--p-color)">ğ™ˆğ˜¼ğ™ğ™ğ™„ğ™“ ğ˜¾ğ™‡ğ™Šğ™ğ˜¿</h1>
            <div id="login-section">
                <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button class="btn-main" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                <p onclick="toggleAuth()" style="margin-top:20px; color:var(--accent); cursor:pointer">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</p>
            </div>
            <div id="reg-section" style="display:none">
                <input type="text" id="reg-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©">
                <select id="reg-type">
                    <option value="pharma">ğŸ’Š ØµÙŠØ¯Ù„ÙŠØ©</option>
                    <option value="store">ğŸ›’ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª / Ù…ØªØ¬Ø±</option>
                </select>
                <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <button class="btn-main" style="background:var(--m-green)" onclick="handleRegister()">Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØªÙØ¹ÙŠÙ„</button>
                <p onclick="toggleAuth()" style="margin-top:20px; color:var(--accent); cursor:pointer">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¯Ø®ÙˆÙ„</p>
            </div>
        </div>
    </div>

    <div id="payment-page" class="page">
        <div class="auth-card">
            <h2>Ø¨ÙˆØ§Ø¨Ø© ØªÙØ¹ÙŠÙ„ Ù…Ø§ØªØ±ÙƒØ³ ğŸ’³</h2>
            <div class="visa-card">
                <div class="number">**** **** **** 2026</div>
                <div id="user-display" style="text-transform: uppercase;">CLIENT NAME</div>
            </div>
            <input type="text" id="activation-code" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…">
            <button class="btn-main" onclick="verifyActivation()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù†</button>
            <p style="color:red; font-size:12px; margin-top:15px">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯</p>
        </div>
    </div>

    <div id="main-system" class="page">
        <div class="layout">
            <div class="sidebar">
                <h2 style="color:var(--m-green)">ğ™ˆğ˜¼ğ™ğ™ğ™„ğ™“ PRO</h2>
                <div style="margin-top:30px">
                    <div class="nav-item active">ğŸ–¥ï¸ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</div>
                    <div class="nav-item">ğŸ“¦ Ø§Ù„Ù…Ø®Ø§Ø²Ù†</div>
                    <div id="owner-link" class="nav-item" style="display:none; color:orange" onclick="alert('Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ù…ÙØ¹Ù„Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·')">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
                </div>
                <button onclick="logout()" style="margin-top:auto; background:#ef4444; border:none; color:white; padding:12px; border-radius:12px; cursor:pointer">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
            </div>
            <div class="main-view">
                <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                    <h2 id="business-name-view">ØªØ­Ù…ÙŠÙ„...</h2>
                    <div id="clock" style="font-weight:bold"></div>
                </header>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:25px">
                    <div class="stat-box"><small>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</small><div id="stat-sales">0.00</div></div>
                    <div class="stat-box" style="border-color:var(--m-green)"><small>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</small><div id="stat-profit">0.00</div></div>
                    <div class="stat-box" style="border-color:orange"><small>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</small><div id="type-label" style="font-size:18px"></div></div>
                </div>
                <div style="background:white; padding:20px; border-radius:20px">
                    <div style="display:flex; gap:10px; margin-bottom:20px">
                        <input type="text" id="i-n" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" style="margin:0">
                        <input type="number" id="i-p" placeholder="Ø§Ù„Ø³Ø¹Ø±" style="margin:0; width:120px">
                        <button class="btn-main" style="width:150px" onclick="addToBill()">Ø¥Ø¶Ø§ÙØ©</button>
                    </div>
                    <table>
                        <thead><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr></thead>
                        <tbody id="bill-table"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <a href="https://wa.me/201224815487" class="wa-float">M</a>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† ØµÙˆØ±ØªÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyCzVhJNBC AWGobCLUrRKdBE3OnmUj2H5HI",
            authDomain: "matrix-pos-e7336.firebaseapp.com",
            projectId: "matrix-pos-e7336",
            storageBucket: "matrix-pos-e7336.firebasestorage.app",
            messagingSenderId: "855010877322",
            appId: "1:855010877322:web:9d38df2dd72c446d893273",
            measurementId: "G-SP32CV408S"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function toggleAuth() {
            document.getElementById('login-section').style.display = document.getElementById('login-section').style.display === 'none' ? 'block' : 'none';
            document.getElementById('reg-section').style.display = document.getElementById('reg-section').style.display === 'none' ? 'block' : 'none';
        }

        async function handleRegister() {
            const name = document.getElementById('reg-name').value;
            const type = document.getElementById('reg-type').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            if(!name || !email || !pass) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            try {
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection('users').doc(res.user.uid).set({
                    name, type, email, active: false, role: 'user', sales: 0, profit: 0
                });
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! ØªÙˆØ§ØµÙ„ Ù„ØªÙØ¹ÙŠÙ„Ù‡.");
                location.reload();
            } catch (e) { alert(e.message); }
        }

        async function handleLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            try {
                const res = await auth.signInWithEmailAndPassword(email, pass);
                checkUser(res.user.uid);
            } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„"); }
        }

        async function checkUser(uid) {
            const doc = await db.collection('users').doc(uid).get();
            const data = doc.data();
            if (data.active || data.role === 'admin') {
                showPage('main-system');
                document.getElementById('business-name-view').innerText = data.name;
                document.getElementById('type-label').innerText = data.type === 'pharma' ? 'ØµÙŠØ¯Ù„ÙŠØ©' : 'Ù…ØªØ¬Ø±';
                document.getElementById('stat-sales').innerText = data.sales.toFixed(2);
                if(data.role === 'admin') document.getElementById('owner-link').style.display = 'block';
            } else {
                showPage('payment-page');
                document.getElementById('user-display').innerText = data.name;
            }
        }

        async function verifyActivation() {
            const code = document.getElementById('activation-code').value;
            if (code === "MATRIX-2026") {
                await db.collection('users').doc(auth.currentUser.uid).update({ active: true });
                alert("ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload();
            } else { alert("ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦"); }
        }

        function addToBill() {
            const n = document.getElementById('i-n').value, p = parseFloat(document.getElementById('i-p').value);
            if(n && p) {
                const row = `<tr><td>${n}</td><td>${p}</td><td>1</td><td>${p}</td></tr>`;
                document.getElementById('bill-table').innerHTML += row;
            }
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function logout() { auth.signOut(); location.reload(); }
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('ar-EG'); }, 1000);
        
        auth.onAuthStateChanged(user => { if(user) checkUser(user.uid); });
    </script>
</body>
</html>
